$(document).ready(function(){function t(){$("#sidebar-menu > ul > li > a").click(function(){$("#sidebar-menu li").removeClass("selected"),$(this).closest("li").addClass("selected");var t=$(this).next();return t.is("ul")&&t.is(":visible")&&($(this).closest("li").removeClass("selected"),t.slideUp("fast")),t.is("ul")&&!t.is(":visible")&&($("#sidebar-menu ul ul:visible").slideUp("fast"),t.slideDown("fast")),0==$(this).closest("li").find("ul").children().length?!0:!1})}function a(){$.ajax({url:"/sidebar",data:{do_not_lock:1,menu:I},error:function(t){},dataType:"html",success:function(a){$("#sidebar-menu-list").html(a),$("#sidebar-menu-list li").not(".no-sort").sort(e).appendTo("#sidebar-menu-list"),$("#sidebar-menu-list li").not(".no-sort").each(function(t,a){0==$(a).data("visible")&&$(a).hide()}),t()},type:"POST"})}function e(t,a){return $(a).data("position")<$(t).data("position")?1:-1}function r(t){$.ajax({url:"/"+t+"/hierarchy",error:function(t){},dataType:"html",success:function(a){$("#"+t+"-hierarchy").html(a)},type:"POST"})}function i(t){$("#"+t+"_field").length&&(s(t),$('input[name="'+t+'"]').on("switchChange.bootstrapSwitch",function(a,e){s(t)}))}function s(t){var a=t+"_field";$('input[name="'+t+'"]').is(":checked")?$("#"+a).show():$("#"+a).hide()}function n(t){$(t+" #template_id").on("change",function(){$.ajax({url:$(t).attr("data-url"),type:"post",data:{template_id:$(this).val(),user_id:$(t).attr("data-user-id"),task_id:$(t).attr("data-task-id")},error:function(t){},success:function(a){"success"==a.status&&($(t+" #mail_subject").val(a.subject),$(t+" #mail_body").summernote("code",a.body))}})})}function o(t){$(t).iCheck({checkboxClass:"icheckbox_flat-blue",radioClass:"iradio_flat-blue",increaseArea:"20%"})}function l(t){$(t).selectpicker({size:5,liveSearch:!0})}function d(t){$(t).length&&$(t).summernote({placeholder:"Type here",height:$(".summernote").attr("data-height")?$(".summernote").attr("data-height"):100})}function c(t){$(t).length>0&&($(t).attr("readonly","readonly"),$(t).datepicker({format:"yyyy-mm-dd",autoclose:!0,multidate:!1,clearBtn:!0,todayHighlight:!0,language:F}))}function u(){$("textarea").on("propertychange keyup input paste",function(){if($(this).attr("data-show-counter")>0){var t=$(this).attr("data-limit")?$(this).data("limit"):D,a=t-$(this).val().length;0>=a&&$(this).val($(this).val().substring(0,t)),$(this).next("span").text((0>=a?0:a)+" "+A)}})}function h(){$.each($("textarea[data-autoresize]"),function(){var t=this.offsetHeight-this.clientHeight,a=function(a){$(a).css("height","auto").css("height",a.scrollHeight+t)};$(this).on("keyup input",function(){a(this)}).removeAttr("data-autoresize")})}function m(t){if($("#"+t).attr("data-extra"))var a="table=table"+$("#"+t).attr("data-extra");else var a="table=table";$.ajax({url:$("#"+t).attr("data-source"),data:a,error:function(t){},dataType:"html",success:function(a){$("#"+t+"> tbody").html(a),$(".show-table td:last-child").addClass("text-right")},type:"POST"})}function f(){$("#myModal #task-user-email-form").length&&n("#myModal #task-user-email-form"),$("#myModal .switch-input").bootstrapSwitch(),$('input[data-role="tagsinput"]').length&&$('input[data-role="tagsinput"]').tagsinput("refresh"),l(".show-tick"),o("#myModal .icheck"),c("#myModal .datepicker"),d("#myModal .summernote"),u(),h();var t=$("#myModal").find("form");$("#myModal").find("form").on("submit",function(a){"noAjax"!=$(t).attr("data-submit")&&(a.preventDefault(),b($(t)))}),$("#myModal .password-strength").pwstrength()}function p(){mail_driver=$("#mail_driver").val(),$(".mail_config").hide(),"smtp"==mail_driver?$("#smtp_configuration").show():"mandrill"==mail_driver?$("#mandrill_configuration").show():"mailgun"==mail_driver?$("#mailgun_configuration").show():$(".mail_config").hide()}function g(){$("form").on("submit",function(t){var a=$("#"+$(this).attr("id"));$(a).find(".switch-input").each(function(){if(!$(this).is(":checked")&&0==$(this).attr("data-off-value"))var t='<input type="hidden" name="'+$(this).attr("name")+'" value="0" />';$(a).append(t)}),"noAjax"!=a.attr("data-submit")&&(t.preventDefault(),b(a))})}function b(t){t.find(":submit").prop("disabled",!0),$("#loading-img").fadeIn("slow"),toastr.info(z,"",{positionClass:M}),$("#"+t.attr("id")).find(".form-group").removeClass("has-error");var e=new FormData($("#"+t.attr("id"))[0]);e.append("ajax_submit",1),t.attr("data-draggable")&&$(".draggable-container .draggable").each(function(t,a){e.append($(a).attr("data-name"),$(a).attr("data-index"))}),$.ajax({url:t.attr("action"),type:"post",contentType:!1,processData:!1,data:e,success:function(e){var i=e.force_redirect?e.force_redirect:"",s=e.redirect?e.redirect:t.attr("data-redirect")?t.attr("data-redirect"):"",n=t.attr("data-redirect-msg")?t.attr("data-redirect-msg"):B,o=t.attr("data-redirect-duration")?t.attr("data-redirect-duration"):2e3;toastr.clear(),"error"==e.status?(toastr.error(e.message,"",{positionClass:M}),i&&setTimeout(function(){window.location.href=i},o)):(e.message&&toastr.success(e.message,"",{positionClass:M}),s&&(toastr.success(n,"",{positionClass:M}),setTimeout(function(){window.location.href=s},o)),$("#myModal").modal("hide"),$(".datatable").length>0&&w(),t.attr("data-refresh")&&T(t.attr("data-refresh")),t.attr("data-no-form-clear")||v(t),t.attr("data-sidebar")&&a(),$("#setup_guide").length>0&&$("#setup_guide").html(e.setup_guide),t.attr("data-setup-guide-complete")&&$("#setup_panel").hide(),$("#location-hierarchy").length&&r("location"),$("#designation-hierarchy").length&&r("designation"),t.attr("data-table-refresh")&&m(t.attr("data-table-refresh")),e.refresh_table&&m(e.refresh_table),e.refresh_content&&T(e.refresh_content),e.new_data&&$("#"+e.new_data.field).length>0&&($("#"+e.new_data.field).append('<option value="'+e.new_data.id+'">'+e.new_data.value+"</option>"),$("#"+e.new_data.field).selectpicker("refresh")))},error:function(a){if(toastr.clear(),422===a.status){var e=JSON.parse(a.responseText),r="";$.each(e,function(a,e){$("#"+t.attr("id")+' input[name="'+a+'"]').closest(".form-group").addClass("has-error"),""==r&&($("#"+t.attr("id")+' input[name="'+a+'"]').focus(),H||(r=e[0]+"<br />")),H&&(r+=e[0]+"<br />")}),toastr.error(r,"",{positionClass:M})}else toastr.error(O,"",{positionClass:M})},complete:function(a){t.find(":submit").prop("disabled",!1),$("#loading-img").fadeOut("slow")}})}function v(t){$(t).find(":input").each(function(){switch(this.type){case"email":case"url":case"number":case"password":case"text":case"textarea":case"file":$(this).val("");break;case"checkbox":case"radio":this.checked=!1,$(t).find(".icheck").iCheck({uncheckedClass:"",checkboxClass:"icheckbox_flat-blue",radioClass:"iradio_flat-blue",increaseArea:"20%"})}}),$(".show-tick").selectpicker("val",""),$(".summernote").length&&$(t).find(".summernote").summernote("reset")}function x(t){var a;return a=$("#"+t).attr("data-form")?$("#"+$("#"+t).attr("data-form")).serialize():{_token:S}}function y(t){return[{extend:"print",text:'<i class="fa fa-print"></i>',title:$("#"+t).attr("data-table-title"),exportOptions:{columns:":visible"}},{extend:"excel",text:'<i class="fa fa-file-excel-o"></i>',exportOptions:{columns:":visible"}},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i>',title:$("#"+t).attr("data-table-title"),exportOptions:{columns:":visible"}},{extend:"copy",text:'<i class="fa fa-files-o"></i>',exportOptions:{columns:":visible"}},{extend:"colvis",text:'<i class="fa fa-columns"></i>'}]}function w(){$(".datatable").each(function(t,a){var e=$(this).attr("id");N[e].ajax.reload()})}function k(t){var a="ajax_submit=1"+$(t).attr("data-extra");$.ajax({url:$(t).attr("data-source"),data:a,dataType:"json",type:"post",error:function(t){toastr.error(O,"",{positionClass:M})},success:function(a){"error"==a.status?toastr.error(a.message,"",{positionClass:M}):($(".datatable").length>0&&w(),$(t).attr("data-refresh")&&T($(t).attr("data-refresh")),$(t).attr("data-table-refresh")&&m($(t).attr("data-table-refresh")),a.message&&toastr.success(a.message,"",{positionClass:M}),a.redirect&&setTimeout(function(){window.location.href=a.redirect},2e3))}})}function _(){$.ajax({url:"/fetch-chat",data:{do_not_lock:1},error:function(t){},dataType:"html",success:function(t){$("#chat-messages").html(t),$("#chat-messages .textAvatar").nameBadge(),$("#chat-box").animate({scrollTop:$(".chat-widget").height()},"fast")},type:"POST"})}function j(){var t="token="+$("#load-message").attr("data-token");$.ajax({url:"/load-message",error:function(t){},data:t,dataType:"html",success:function(t){$("#load-message").html(t),$("#load-message .textAvatar").nameBadge()},type:"POST"})}function C(t){var a="ajax=1"+$("#"+t).attr("data-extra"),e=$("#"+t).attr("data-source");$.ajax({url:e,error:function(t){},data:a,dataType:"html",success:function(a){$("#"+t).html(a),$("#"+t+" .textAvatar").nameBadge(),$(".show-table td:last-child").addClass("text-right")},type:"POST"})}function T(t){for(var a=t.split(","),e=0;e<a.length;e++)"chat-messages"==a[e]?_():"load-message"==a[e]?j():$("#"+a[e]).length&&C(a[e])}$.ajaxSetup({headers:{"X-CSRF-Token":$("meta[name=csrf-token]").attr("content")}}),$(window).load(function(){$("#loading").fadeOut("slow")});var S=$('meta[name="csrf-token"]').attr("content"),M=$("#js-var").attr("data-toastr-position"),O=$("#js-var").attr("data-something-error-message"),A=$("#js-var").attr("data-character-remaining"),D=$("#js-var").attr("data-textarea-limit"),z=$("#js-var").attr("data-processing-messsage"),B=$("#js-var").attr("data-redirecting-messsage"),H=$("#js-var").attr("data-show-error-message"),P=$("#js-var").attr("data-calendar-language"),W=$("#js-var").attr("data-datatable-language"),F=$("#js-var").attr("data-datepicker-language"),I=$("#js-var").attr("data-menu");$(".slimscroller").slimscroll({height:"auto",size:"15px",railOpacity:.3,wheelStep:5}),$(".slider").length&&($(".slider").slider(),$(".slider").on("slide",function(t){var a=t.value,e=a[0]+"% to "+a[1]+"%";$("#slider-value").text(e)})),$(".tooltips").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$("button.show-sidebar").click(function(){$("div.left").toggleClass("mobile-sidebar"),$("div.right").toggleClass("mobile-content"),$("div.logo-brand").toggleClass("logo-brand-toggle")}),t(),a(),$(".draggable-container").sortable({update:function(t,a){$(".draggable-container .draggable").each(function(t,a){$elm=$(a),$elm.attr("data-index",$elm.index(".draggable-container .draggable"))})}}),$("#location-hierarchy").length&&r("location"),$("#designation-hierarchy").length&&r("designation"),$(".switch-input").bootstrapSwitch(),$("input[type=file]").bootstrapFileInput(),$(".password-strength").pwstrength(),$(".textAvatar").nameBadge(),$(".show-table td:last-child").addClass("text-right"),c(".datepicker"),o(".icheck"),l(".show-tick"),d(".summernote"),$(".enable-show-hide").each(function(t,a){var e=$(this).attr("name");i(e)}),$("#user-email-form").length&&n("#user-email-form"),$("form").on("keyup keypress",function(t){var a=t.keyCode||t.which;return 13===a&&$(this).attr("data-disable-enter-submission")?(t.preventDefault(),!1):void 0}),$(document).on("click","[data-submit-confirm-text]",function(t){t.preventDefault();var a=$(this);bootbox.confirm("Are you sure?",function(t){if(t){var e=a.closest("form");"noAjax"!=e.attr("data-submit")?b(e):$(e).submit()}})}),$(document).on("click",".alert-delete",function(t){t.preventDefault(),bootbox.confirm("Are you sure?",function(a){a&&$(this).attr("data-ajax")&&(t.preventDefault(),k(this))})}),$(".input-daterange").datepicker({format:"yyyy-mm-dd",clearBtn:!0}),$("#myWizard").length>0&&$("#myWizard").easyWizard({buttonsClass:"btn btn-default",submitButtonClass:"btn btn-primary",showSteps:!0,showButtons:!0,submitButton:!1}),$(".custom-field-option").hide(),$(document).on("change","#type",function(){var t=$("#custom-field-form #type").val();"select"==t||"radio"==t||"checkbox"==t?$(".custom-field-option").show():$(".custom-field-option").hide()}),g(),h(),u(),$('input[data-role="tagsinput"]').length&&$('input[data-role="tagsinput"]').tagsinput("refresh"),$(".ajax-table").each(function(t,a){var e=$(a).attr("id");m(e)}),$("#myModal").on("show.bs.modal",function(t){var a=$(t.relatedTarget);a.attr("data-href")&&$.get(a.attr("data-href"),function(t){$("#myModal").find(".modal-content").html(t),$("#myModal").modal("show"),f()},"html")}),p(),$("#mail_driver").on("change",function(){p()}),$("#render_calendar").length>0&&$("#render_calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},locale:P,events:calendar_events,eventRender:function(t,a){$(a).tooltip({title:t.title})}});var U="<'row'<'col-sm-5 margin-left-10'li><'col-sm-5 pull-right margin-right-10'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-4 margin-left-10'B><'col-sm-6 pull-right margin-right-10'p>>",N=[];$(".datatable").length>0&&$(".datatable").each(function(t,a){var e=$(this).attr("id");N[e]=$("#"+e).DataTable({dom:U,buttons:y(e),ajax:{url:"/"+$("#"+e).attr("data-table-source")+"/lists",type:"post",data:function(t){return x(e)}},ordering:!0,autoWidth:!0,language:{url:W},order:$("#"+e).attr("data-disable-sorting")?[]:[[1,"asc"]],columnDefs:$("#"+e).attr("data-disable-sorting")?[]:[{orderable:!1,targets:0}]}),$("#"+e).on("xhr.dt",function(t,a,r){if(r.foot){var i=$("#"+e).find("tfoot");i.length||(i=$("<tfoot>").appendTo("#"+e)),i.html(r.foot)}})}),$(document.body).on("click","a",function(t){$('[data-toggle="tooltip"]').tooltip("destroy"),$(this).attr("data-ajax")&&(t.preventDefault(),k(this))}),$("#chat-messages").length&&(_(),$("#chat-messages").attr("data-chat-refresh")>0&&setInterval(function(){_()},1e3*$("#chat-messages").attr("data-chat-refresh-duration"))),$("#load-message").length&&j(),$("#load-task-detail").length&&C("load-task-detail"),$("#load-task-description").length&&C("load-task-description"),$("#load-task-activity").length&&C("load-task-activity"),$("#load-task-comment").length&&C("load-task-comment"),$("#load-task-top-chart").length&&C("load-task-top-chart"),$(".login-as").on("click",function(){$("input[name='username']").val($(this).attr("data-username")),$("input[name='email']").val($(this).attr("data-email")),$("input[name='password']").val($(this).attr("data-password"))})}),function(t){t.fn.nameBadge=function(a){var e=t.extend({border:{color:"#ddd",width:0},colors:["#458b00","#f85931","#ce1836","#009989","#00688b","#8b1a1a"],text:"#fff",margin:2,middlename:!0,uppercase:!0,max:3},a);return this.each(function(){var a=t(this).text(),r=t(this).attr("data-image-size")?t(this).attr("data-image-size"):60;a.trim()||(a="User");var i=a.match(e.middlename?/\b(\w)/g:/^\w|\b\w(?=\S+$)/g),s=i.join("");s=s.substr(0,e.max),t(this).text(s),t(this).css({color:e.text,"background-color":e.colors[Math.floor(Math.random()*e.colors.length)],border:e.border.width+"px solid "+e.border.color,display:"inline-block","font-family":"Arial, 'Helvetica Neue', Helvetica, sans-serif","font-size":.4*r,"border-radius":r+"px",width:r+"px",height:r+"px","line-height":r+"px",margin:e.margin+"px","text-align":"center","float":"left","text-transform":e.uppercase?"uppercase":""})})}}(jQuery);